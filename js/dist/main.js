define("Control",["require"],function(e){return function(e,t){var n=this,o=!1,i=performance.now(),r=new THREE.Vector3,s=new THREE.Object3D,a=new THREE.Object3D,c=Math.PI/2,d=!1,l=!1,u=!1,E=!1,m=!1,h=!1;this.enabled=!1,t.rotation.set(0,0,0),s.add(t),a.position.y=10,a.add(s),e.add(a),document.addEventListener("resetgame",function(){o=!1,i=performance.now(),r.set(0,0,0),s.rotation.set(0,0,0),a.position.set(0,10,0),a.rotation.set(0,0,0),d=!1,l=!1,u=!1,E=!1,m=!1,h=!1},!1),this.onMouseMove=function(e){if(!1!==n.enabled){var t=e.movementX||e.mozMovementX||e.webkitMovementX||0,i=e.movementY||e.mozMovementY||e.webkitMovementY||0;!1===o?(a.rotation.y-=.004*t,s.rotation.x-=.004*i):(a.rotation.y-=.001*t,s.rotation.x-=.001*i),s.rotation.x=Math.max(-c,Math.min(c,s.rotation.x))}},this.getObject=function(){return a},this.getDirection=function(){var e=new THREE.Vector3(0,0,-1),t=new THREE.Euler(0,0,0,"YXZ"),n=new THREE.Vector3(0,0,-1);return t.set(s.rotation.x,a.rotation.y,0),n.copy(e).applyEuler(t),n},this.update=function(){if(this.enabled){var e=performance.now(),t=(e-i)/1e3;r.x-=10*r.x*t,r.z-=10*r.z*t,r.y-=9.8*100*t,d&&(r.z-=600*t),l&&(r.z+=600*t),u&&(r.x-=600*t),E&&(r.x+=600*t),a.translateX(r.x*t),a.translateY(r.y*t),a.translateZ(r.z*t),a.position.x>490&&(a.position.x=490),a.position.x<-490&&(a.position.x=-490),a.position.z>490&&(a.position.z=490),a.position.z<-490&&(a.position.z=-490),a.position.y<10&&(r.y=0,a.position.y=10,m=!0),h&&m&&(r.y=0,a.position.y=0),i=e}},this.onKeyDown=function(e){if(!1!==this.enabled)switch(e.keyCode){case 38:case 87:d=!0;break;case 37:case 65:u=!0;break;case 40:case 83:l=!0;break;case 39:case 68:E=!0;break;case 32:!0===m&&(r.y+=300),m=!1;break;case 16:h=!0}},this.onKeyUp=function(e){switch(e.keyCode){case 38:case 87:d=!1;break;case 37:case 65:u=!1;break;case 40:case 83:l=!1;break;case 39:case 68:E=!1;break;case 16:h=!1}},this.onMouseDown=function(e){!1!==this.enabled&&2===e.button&&(!0===o?(o=!1,t.fov=45):(o=!0,t.fov=10),t.updateProjectionMatrix())},this.dispose=function(){document.removeEventListener("mousemove",this.onMouseMove,!1),document.removeEventListener("keydown",this.onKeyDown,!1),document.removeEventListener("keyup",this.onKeyUp,!1)},document.addEventListener("mousemove",this.onMouseMove,!1),document.addEventListener("keydown",this.onKeyDown,!1),document.addEventListener("keyup",this.onKeyUp,!1),document.addEventListener("mousedown",this.onMouseDown,!1)}}),define("CollisionMgr",["require"],function(e){return{targets:[],player:null,control:null,setPlayerControl:function(e,t){this.player=e,this.control=t},add:function(e){this.targets.push(e)},checkCollision:function(e){if(e.x<500&&e.x>-500&&e.z<500&&e.z>-500&&e.y<15&&e.y>0)for(var t=0;t<this.targets.length;t++)if(13>=e.distanceTo(this.targets[t].target_mesh.position))return this.targets[t].hit(),!0;return!1},checkPlayerCollision:function(e){return 5>=e.distanceTo(this.control.getObject().position)&&(this.player.hit(),!0)},remove:function(e){for(var t=0;t<this.targets.length;t++)if(e===this.targets[t])return void this.targets.splice(t,1)},getNonCollidingPos:function(e){for(var t=new THREE.Vector3(0,10,0);;)if(t.x=50*Math.floor(18*(Math.random()-.5)+1),t.z=50*Math.floor(18*(Math.random()-.5)+1),80<t.distanceTo(e)){var n=0;for(n=0;n<this.targets.length&&!(5>t.distanceTo(this.targets[n].target_mesh.position));n++);if(n===this.targets.length)return t}}}}),define("Bullet",["CollisionMgr"],function(e){var t=new THREE.SphereGeometry(1,20,20),n=new THREE.MeshPhongMaterial({color:255,emissive:new THREE.Color(1,0,0)}),o=new THREE.MeshPhongMaterial({color:255,emissive:new THREE.Color(0,0,1)});return function(i,r,s){function a(){var t=performance.now();if(i.enabled){var n=.5*(t-u);l.position.x+=c.x*n,l.position.y+=c.y*n,l.position.z+=c.z*n,s?e.checkPlayerCollision(l.position)&&E.Remove():e.checkCollision(l.position)&&E.Remove()}u=t,m&&setTimeout(a,20)}var c=i.getDirection(),d=i.getObject().position,l=new THREE.Mesh(t,n);s&&(c=new THREE.Vector3,c.subVectors(i.getObject().position,s.target_mesh.position),c.normalize(),d=s.target_mesh.position,l.material=o);var u=performance.now();l.position.set(d.x,d.y-1,d.z),r.add(l);var E=this,m=!0;this.Remove=function(){m=!1,r.remove(l)},document.addEventListener("resetgame",function(){E.Remove()},!1),a(),setTimeout(function(){E.Remove()},1e4)}}),define("Player",["CollisionMgr","Bullet"],function(e,t){return function(n,o,i){function r(e){!1!==i.enabled&&0===e.button&&new t(i,n)}function s(){l.opacity<1.1&&l.opacity>.9&&(d=-.1),l.opacity+=d,l.needsUpdate=!0,l.opacity>.05?setTimeout(s,20):d=.1}document.addEventListener("mousedown",r,!1);var a,c=100,d=.1,l=new THREE.MeshBasicMaterial({color:16720418,transparent:!0,opacity:0});!function(){var e=new THREE.MeshBasicMaterial({color:0}),t=new THREE.MeshBasicMaterial({color:4521796}),n=new THREE.TorusGeometry(.1,.005,2,50),i=new THREE.Mesh(n,e);i.position.set(0,0,-1.5),o.add(i);var r=new THREE.TorusGeometry(.1,.007,2,50),s=new THREE.Mesh(r,t);s.position.set(0,0,-1.5001),o.add(s);var a=new THREE.PlaneGeometry(.15,.01),c=new THREE.Mesh(a,e);c.position.set(.1,0,-1.5),o.add(c),c=new THREE.Mesh(a,e),c.position.set(-.1,0,-1.5),o.add(c);var d=new THREE.PlaneGeometry(.01,.15);c=new THREE.Mesh(d,e),c.position.set(0,.1,-1.5),o.add(c),c=new THREE.Mesh(d,e),c.position.set(0,-.1,-1.5),o.add(c);var l=new THREE.PlaneGeometry(.154,.014);c=new THREE.Mesh(l,t),c.position.set(.1,0,-1.5001),o.add(c),c=new THREE.Mesh(l,t),c.position.set(-.1,0,-1.5001),o.add(c);var u=new THREE.PlaneGeometry(.014,.154);c=new THREE.Mesh(u,t),c.position.set(0,.1,-1.5001),o.add(c),c=new THREE.Mesh(u,t),c.position.set(0,-.1,-1.5001),o.add(c)}(),function(){var e=new THREE.MeshLambertMaterial({color:6710886}),t=new THREE.CylinderGeometry(.25,.25,6,20),n=new THREE.Mesh(t,e);n.position.set(0,-1,-4),n.rotation.x=Math.PI/2,o.add(n)}(),function(){var e=new THREE.BoxGeometry(21,2,.05),t=new THREE.MeshBasicMaterial({color:5635925}),n=new THREE.MeshBasicMaterial({color:5592405}),i=new THREE.Mesh(e,n);a=new THREE.Mesh(power_geoms[100],t),a.add(i),a.scale.set(.04,.04,.04),a.position.set(0,-.4,-1.1),o.add(a)}(),function(){var e=new THREE.Mesh(new THREE.PlaneGeometry(10,10),l);e.position.set(0,0,-2),o.add(e)}(),e.setPlayerControl(this,i),this.hit=function(){if(c>0)if(s(),(c-=5)<1){c=0,a.geometry=new THREE.Geometry;var e=new Event("gameover");document.dispatchEvent(e)}else a.geometry=power_geoms[c]},document.addEventListener("resetgame",function(){c=100,d=.1,a.geometry=power_geoms[c]},!1)}}),define("PlayGround",["Control","Player","Bullet"],function(e,t,n){return function(e){var t=new THREE.HemisphereLight(15658751,7829384,.75);t.position.set(.5,1,.75),e.add(t);var n=document.createElement("canvas");n.width=128,n.height=128,function(){function t(e){var t=new THREE.Texture(n),o=new THREE.MeshBasicMaterial({map:t,overdraw:.5,side:THREE.DoubleSide}),i=new Image;return i.onload=function(){t.image=this,t.needsUpdate=!0},i.crossOrigin="anonymous",i.src=e,o}var o=[t("texture/xpos.png"),t("texture/xneg.png"),t("texture/ypos.png"),t("texture/yneg.png"),t("texture/zpos.png"),t("texture/zneg.png")],i=new THREE.Mesh(new THREE.BoxGeometry(5e3,5e3,5e3),new THREE.MultiMaterial(o));i.scale.x=-1,e.add(i)}(),function(){var t=new THREE.Texture(n);t.wrapS=t.wrapT=THREE.RepeatWrapping,t.repeat.set(50,50);var o=new Image;o.onload=function(){t.image=this,t.needsUpdate=!0},o.crossOrigin="anonymous",o.src="texture/grass.png";var i=new THREE.PlaneGeometry(1e3,1e3,50,50),r=new THREE.MeshBasicMaterial({map:t,side:THREE.DoubleSide}),s=new THREE.Mesh(i,r);s.position.y=-10,s.rotation.x=Math.PI/2,e.add(s);var a=new THREE.Texture(n);a.wrapS=a.wrapT=THREE.RepeatWrapping,a.repeat.set(20,2);var c=new Image;c.onload=function(){a.image=this,a.needsUpdate=!0},c.crossOrigin="anonymous",c.src="texture/brick2.png";var d=new THREE.PlaneGeometry(1e3,100,20,2),l=new THREE.MeshBasicMaterial({map:a,side:THREE.DoubleSide}),u=new THREE.Mesh(d,l);u.position.z=-500,u.position.y=40,e.add(u),u=new THREE.Mesh(d,l),u.position.z=500,u.position.y=40,e.add(u),u=new THREE.Mesh(d,l),u.position.x=-500,u.position.y=40,u.rotation.y=Math.PI/2,e.add(u),u=new THREE.Mesh(d,l),u.position.x=500,u.position.y=40,u.rotation.y=Math.PI/2,e.add(u)}()}}),define("ResetControl",["require"],function(e){function t(e){function t(e){if(i.style.display="none",s.requestPointerLock=s.requestPointerLock||s.mozRequestPointerLock||s.webkitRequestPointerLock,/Firefox/i.test(navigator.userAgent)){var t=function(e){document.fullscreenElement!==s&&document.mozFullscreenElement!==s&&document.mozFullScreenElement!==s||(document.removeEventListener("fullscreenchange",t),document.removeEventListener("mozfullscreenchange",t),s.requestPointerLock())};document.addEventListener("fullscreenchange",t,!1),document.addEventListener("mozfullscreenchange",t,!1),s.requestFullscreen=s.requestFullscreen||s.mozRequestFullscreen||s.mozRequestFullScreen||s.webkitRequestFullscreen,s.requestFullscreen()}else s.requestPointerLock()}this.Paused=function(){return!e.enabled};var n=!1,o=document.getElementById("blocker"),i=document.getElementById("instructions"),r=document.getElementById("gameover");if("pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document){var s=document.body,a=function(t){if(document.pointerLockElement===s||document.mozPointerLockElement===s||document.webkitPointerLockElement===s){if(e.enabled=!0,o.style.display="none",r.style.opacity="0",n){n=!1;var a=new Event("resetgame");document.dispatchEvent(a)}}else e.enabled=!1,o.style.display="-webkit-box",o.style.display="-moz-box",o.style.display="box",i.style.display=""},c=function(e){i.style.display=""},d=function(){n=!0,r.style.opacity="1",document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock,document.exitPointerLock()};document.addEventListener("pointerlockchange",a,!1),document.addEventListener("mozpointerlockchange",a,!1),document.addEventListener("webkitpointerlockchange",a,!1),document.addEventListener("pointerlockerror",c,!1),document.addEventListener("mozpointerlockerror",c,!1),document.addEventListener("webkitpointerlockerror",c,!1),document.addEventListener("gameover",d,!1),i.addEventListener("click",t,!1)}else i.innerHTML="Your browser doesn't seem to support Pointer Lock API";this.Reset=function(){r.style.opacity="1",a&&a()}}return t}),define("Target",["CollisionMgr","Bullet"],function(e,t){function n(n,d,l,u){function E(){if(w>-1)d.enabled&&(g.geometry=time_geoms[w],g.position.x=-g.geometry.boundingBox.max.x/2,w-=1,y.target_mesh.lookAt(d.getObject().position),w%5==0&&new t(d,n,y)),h&&setTimeout(E,1e3);else{var e=new Event("resetgame");document.dispatchEvent(e)}}var m=c.default;u&&c[u]&&(m=c[u]);var h=!0,w=m.time,p=100,g=new THREE.Mesh(time_geoms[w],i);g.position.y=15,g.position.x=-g.geometry.boundingBox.max.x/2;var v=new THREE.Mesh(a,s),f=new THREE.Mesh(power_geoms[100],r);f.position.y=13,v.position.y=13,this.target_mesh=new THREE.Mesh(o,m.mat),this.target_mesh.position.set(l.x,5,l.z),this.target_mesh.add(g),this.target_mesh.add(f),this.target_mesh.add(v),n.add(this.target_mesh),e.add(this);var y=this;document.addEventListener("resetgame",function(){h=!1,e.remove(y),n.remove(y.target_mesh)},!1),this.hit=function(){p-=m.power_subs,p>0?f.geometry=power_geoms[p]:(h=!1,e.remove(y),n.remove(y.target_mesh))},E()}var o=new THREE.SphereGeometry(12,20,20),i=(new THREE.MeshPhongMaterial({color:16733525}),new THREE.MeshPhongMaterial({color:16746632,emissive:new THREE.Color(.25,0,0)})),r=new THREE.MeshBasicMaterial({color:16733525}),s=new THREE.MeshBasicMaterial({color:5592405}),a=new THREE.BoxGeometry(21,2,.05),c={default:{mat:new THREE.MeshPhongMaterial({color:16733525,emissive:new THREE.Color(.25,0,0)}),power_subs:10,time:60,safe:!1},basic:{mat:new THREE.MeshPhongMaterial({color:16777045,emissive:new THREE.Color(.25,.25,0)}),power_subs:5,time:30,safe:!1},danger:{mat:new THREE.MeshPhongMaterial({color:16733695,emissive:new THREE.Color(.25,0,.25)}),power_subs:10,time:15,safe:!1},power:{mat:new THREE.MeshPhongMaterial({color:5636095,emissive:new THREE.Color(.1,.25,.25)}),power_subs:2,time:30,safe:!1},safe:{mat:new THREE.MeshPhongMaterial({color:5635925,emissive:new THREE.Color(.15,.25,.1)}),power_subs:50,time:60,safe:!0}};return n}),requirejs.config({baseUrl:".",paths:{Control:"js/control",Player:"js/player",Bullet:"js/bullet",PlayGround:"js/playground",ResetControl:"js/resetcontrol",Target:"js/target",CollisionMgr:"js/collisionmgr"}});var fontLoader=new Promise(function(e,t){(new THREE.FontLoader).load("font/droid_serif_regular.typeface.json",function(t){window.font=t,window.time_geoms=[],window.power_geoms=[];for(var n=0;n<61;n++)time_geoms.push(new THREE.TextGeometry(n.toString(),{font:window.font,size:6,height:.5,bevelEnabled:!0,bevelSize:.5,bevelThickness:1})),time_geoms[n].computeBoundingBox();for(var n=0;n<101;n++){for(var o=new THREE.BoxGeometry((n+.1)/5,1,.1),i=0;i<o.vertices.length;i++)o.vertices[i].x-=10-n/10;power_geoms.push(o)}var r=document.getElementById("loader");r.parentNode.removeChild(r);var s=document.getElementById("blocker");s.style.display="-webkit-box",s.style.display="-moz-box",s.style.display="box",e()})});fontLoader.then(function(){require(["Control","PlayGround","Player","Bullet","ResetControl","Target","CollisionMgr"],function(e,t,n,o,i,r,s){function a(e){var t=s.getNonCollidingPos(h.getObject().position);new r(u,h,t,e)}function c(){h.enabled&&(w+=1),1===w?(w=2,a("default")):10===w?(w=11,a("basic")):20===w?(w=21,a("danger")):30===w?(w=31,a("power")):40===w&&(w=0,a("safe")),setTimeout(c,1e3)}function d(){h.update(),requestAnimationFrame(d),m.render(u,E)}function l(){E.aspect=window.innerWidth/window.innerHeight,E.updateProjectionMatrix(),m.setSize(window.innerWidth,window.innerHeight)}var u=new THREE.Scene,E=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,1,6e3),m=new THREE.WebGLRenderer({antialias:!0});document.body.appendChild(m.domElement),m.setSize(window.innerWidth,window.innerHeight);var h=new e(u,E);new t(u);player=new n(u,E,h);var w=0;c(),i(h),d(),window.addEventListener("resize",l,!1)})}),define("js/main",function(){});